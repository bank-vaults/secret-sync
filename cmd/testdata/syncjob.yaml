## Used to configure schedule for synchronization.
## The schedule is in Cron format, see https://en.wikipedia.org/wiki/Cron
schedule: "@daily"

## Used to only perform sync once.
## If specified, Schedule will be ignored.
runOnce: false

## Points to a file where all sync logs should be saved to.
auditLogPath: "path/to/file"

## Defines global secret mappings.
mappings:
  ## Username mapping
  - name: username
    secretRef:
      key: /credentials/username

  ## Password mapping
  - name: password
    secretRef:
      key: /credentials/password

  ## Query mapping, returned keys will be available as "dynamic-query.<key>"
  - name: dynamic-query
    secretQuery:
      path: /credentials
      regexp:
        key: .*

## Defines how the secrets will be synced.
strategy:
  ## 1. Usage: Sync key from source to target
  - secretRef:
      key: /credentials/source/username
    # If not specified, will be synced under the same key
    destKey: /credentials/target/username

  ## 2. Usage: Sync queryable keys from source to target
  - secretQuery:
      path: /credentials/source
      regexp:
        key: .*
    # If not specified, will be synced under the same path
    destPath: /credentials/target

  ## 3. Usage: Sync key(s) from source to target via custom boilerplate
  - secretRef:
      key: /credentials/source/username
    # Boilerplate defines how the secret key data will be synced to dest source.
    # It is possible to specify multiple boilerplate items.
    boilerplate:
      - key: '/credentials/target/username'
        # Reserved word "self" defines a mapping of the fetched secretRef.
        # You can also use global mappings here, e.g. {{ valueOf "username" }}.
        value: 'prefix-{{ valueOf "self" }}'

  ## 4. Usage: Sync key(s) from global mappings to target via custom boilerplate
  - boilerplate:
    - key: '/credentials/target/{{ keyOf "username"" }}'
      value: '{{ valueOf "username" }}'

    - key: '/credentials/target/auth'
      valueMap:
        username: '{{ valueOf "username" }}'
        password: '{{ valueOf "password" }}'

    - key: '/credentials/target/dynamic-query'
      valueMap:
        username: '{{ valueOf "dynamic-query.username" }}'
        password: '{{ valueOf "dynamic-query.password" }}'

  ## 5. Usage: Sync queryable keys from source to dest via custom boilerplate
  - secretQuery:
      path: /credentials/source
      regexp:
        key: .*
    boilerplate:
      # All results returned by the query will be executed against the templates.
      # If the template matches "if", it will be synced based on the template config.
      # Reserved word "queryItem" defines a mapping of the current loop query item.
      - if: '{{ (keyOf "queryItem") eq "data" }}' # optional, true if not set
        key: '/credentials/target/{{ keyOf "queryItem"" }}'
        value: 'admin/{{ valueOf "queryItem" }}/{{ valueOf "username" }}'
